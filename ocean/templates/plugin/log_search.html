{% extends "base.html" %}

{% block css %}
<link href="/static/metronic/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />
<link href="/static/metronic/assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% block content %}

                <!-- BEGIN CONTENT -->
                <div class="page-content-wrapper" ng-controller="pluginCtrl">
                    <!-- BEGIN CONTENT BODY -->
                    <div class="page-content">
                        <!-- BEGIN PAGE HEADER-->
                        <!-- BEGIN PAGE BAR -->
                        <div class="page-bar">
                            <ul class="page-breadcrumb">
                                <li>
                                    <span>常用工具</span>
                                    <i class="fa fa-angle-right"></i>
                                </li>
                                <li>
                                    <span>日志搜索</span>
                                </li>
                            </ul>
                        </div>
                        <!-- END PAGE BAR -->
                        <!-- BEGIN PAGE TITLE-->
                        <h1 class="page-title"> 日志工具
                            <small>日志搜索</small>
                        </h1>
                        <!-- END PAGE TITLE-->
                        <!-- END PAGE HEADER-->
                        <div class="row">
                            <div class="col-md-12 ">
                                    <!-- BEGIN SAMPLE FORM PORTLET-->
                                    <div class="portlet light bordered">
                                        <div class="portlet-title">
                                            <div class="caption">
                                                <i class="icon-paper-plane font-green-haze"></i>
                                                <span class="caption-subject bold font-green-haze uppercase">本地日志搜索</span>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <!-- BEGIN FORM-->
                                            <form class="form-horizontal" action="{% url 'plugin:getLogLocal' %}" method="post" target="_blank">
                                                <div class="form-body" >
                                                    <div class="form-group ">
                                                        <label class="control-label col-md-2">日志目录
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control" id="logPath" name="logPath" value="D:\backup\log_search\input" required/>
                                                            </div>
                                                        </div>
                                                        <label class="control-label col-md-2">输出目录
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control" id="outputPath" name="outputPath" value="D:\backup\log_search\output" required/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">日志模板
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8" id="logType" name="logType" required>
                                                                <option value="qq_kcbp" selected>期权日志-kcbp</option>
                                                                <option value="qq_bpu">期权日志-bpu</option>
                                                            </select>
                                                        </div>
                                                        <label class="control-label col-md-2">搜索方式
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8" id="searchType" name="searchType" required>
                                                                <option value="time_type" selected>按时间截取</option>
                                                                <option value="keyword_type">按关键字搜索</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group " id="timeType">
                                                        <label class="control-label col-md-2">开始时间
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon">
                                                                <i class="fa fa-clock-o"></i>
                                                                <input type="text" class="form-control timepicker timepicker-default" id="timeBegin" name="timeBegin"> </div>
                                                        </div>
                                                        <label class="control-label col-md-2">时间间隔
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8" id="interval" name="interval" required>
                                                                <option value="10" selected>10秒</option>
                                                                <option value="30" >30秒</option>
                                                                <option value="60" >1分钟</option>
                                                                <option value="180">3分钟</option>
                                                                <option value="600">10分钟</option>
                                                                <option value="1800">30分钟</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group " id="keywordType" style="display:none">
                                                        <label class="control-label col-md-2">关键字
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control" id="keyword" name="keyword"  value="" /> </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-actions">
                                                    <div class="row">
                                                        <div class="col-md-offset-4 col-md-6">
                                                            <button type="submit" class="btn green">提交</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <!-- END FORM-->
                                        </div>
                                    </div>
                            </div>
                        </div>

                        <br><br>

                        <!-- remote log search begin -->
                        <div class="row">
                            <div class="col-md-12 ">
                                    <!-- BEGIN SAMPLE FORM PORTLET-->
                                    <div class="portlet light bordered">
                                        <div class="portlet-title">
                                            <div class="caption">
                                                <i class="icon-paper-plane font-green-haze"></i>
                                                <span class="caption-subject bold font-green-haze uppercase">远程日志搜索</span>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <!-- BEGIN FORM-->
                                            <form class="form-horizontal" action="{% url 'plugin:getLogRemote' %}" method="post" target="_blank">
                                                <div class="form-body" >
                                                    <div class="form-group ">
                                                        <label class="control-label col-md-2">环境
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="form-control" data-live-search="true" data-size="8" id="envId" name="envId">
                                                                <option value="1">测试环境</option>
                                                                <option value="2">预发环境</option>
                                                                <option value="3" selected>生产环境</option>
                                                                <option value="4">同城灾备</option>
                                                                <option value="5">异地灾备</option>
                                                            </select>
                                                        </div>
                                                        <label class="control-label col-md-2">主机
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control"  id="hosts" name="hosts" value="{[ hosts ]}" readonly/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">应用系统
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8" id="appSystem" name="appSystem" ng-change="appChange()" ng-model="app_name" >
                                                                <option value="">请选择</option>

                                                                {% for obj in appSystems %}
                                                                <option value="{{ obj.app_name }}">{{ obj.chinese_name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <label class="control-label col-md-2">组件
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="form-control" data-live-search="true" data-size="8" id="module" name="module" ng-change="moduleChange()" ng-model="module_name"  >

                                                                <option value="{[ module_name ]}" ng-repeat="module_name in modules">{[ module_name ]}</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2">日志模板
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8"  name="logType" required>
                                                                <option value="qq_kcbp" selected>期权日志-kcbp</option>
                                                                <option value="qq_bpu">期权日志-bpu</option>
                                                            </select>
                                                        </div>
                                                        <label class="control-label col-md-2">输出目录
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control"  name="outputPath" value="D:\backup\log_search\output" required/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group ">
                                                        <label class="control-label col-md-2">搜索方式
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8" id="searchTypeRemote"  name="searchType" required>
                                                                <option value="time_type" selected>按时间截取</option>
                                                                <option value="keyword_type">按关键字搜索</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group " id="timeTypeRemote">
                                                        <label class="control-label col-md-2">开始时间
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-group date form_datetime bs-datetime">
                                                                <input type="text" size="16" class="form-control" name="timeBegin">
                                                                <span class="input-group-addon">
                                                                    <button class="btn default date-set" type="button">
                                                                        <i class="fa fa-calendar"></i>
                                                                    </button>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <label class="control-label col-md-2">时间间隔
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <select class="bs-select form-control" data-live-search="true" data-size="8"  name="interval" required>
                                                                <option value="10" selected>10秒</option>
                                                                <option value="30" >30秒</option>
                                                                <option value="60" >1分钟</option>
                                                                <option value="180">3分钟</option>
                                                                <option value="600">10分钟</option>
                                                                <option value="1800">30分钟</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group "  style="display:none" id="keywordTypeRemote">
                                                        <label class="control-label col-md-2">关键字
                                                            <span class="required"> * </span>
                                                        </label>
                                                        <div class="col-md-3">
                                                            <div class="input-icon right">
                                                                <i class="fa"></i>
                                                                <input type="text" class="form-control"  name="keyword"  value="" /> </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-actions">
                                                    <div class="row">
                                                        <div class="col-md-offset-4 col-md-6">
                                                            <button type="submit" class="btn green">提交</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                            <!-- END FORM-->
                                        </div>
                                    </div>
                            </div>
                        </div>
                        <!-- remote log search end -->

                    </div>
                    <!-- END CONTENT BODY -->
                </div>
                <!-- END CONTENT -->

{% endblock %}

<!-- BEGIN EXTRA SCRIPTS -->
{% block script %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
        <script src="/static/metronic/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
        <script src="/static/metronic/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
        <!-- END PAGE LEVEL SCRIPTS -->
        <script type="text/javascript">
            $(document).ready(function(){
                $("#searchType").change(function(){
                    if ($("#searchType").val() == "time_type"){
                        $("#timeType").show();
                        $("#keywordType").hide();
                    }else{
                        $("#timeType").hide();
                        $("#keywordType").show();
                    }
                });

                $("#searchTypeRemote").change(function(){
                    if ($("#searchTypeRemote").val() == "time_type"){
                        $("#timeTypeRemote").show();
                        $("#keywordTypeRemote").hide();
                    }else{
                        $("#timeTypeRemote").hide();
                        $("#keywordTypeRemote").show();
                    }
                });

                $('.timepicker-default').timepicker({
                    autoclose: true,
                    showSeconds: true,
                    showMeridian: false,
                    minuteStep: 1
                });

                $(".form_datetime").datetimepicker({
                    autoclose: true,
                    isRTL: App.isRTL(),
                    format: "yyyy-mm-dd hh:ii:ss",
                    minuteStep: 1,
                    fontAwesome: true,
                    pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
                });

            });

        </script>
{% endblock %}
<!-- END EXTRA SCRIPTS -->